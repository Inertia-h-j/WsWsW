<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>쓰레기 분리수거 웹 W.S.W</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            font-family: Arial, sans-serif;
        }

        h1 {
            margin-bottom: 20px;
        }

        #webcam-container {
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid #ccc;
            border-radius: 8px;
            width: 640px;
            height: 480px;
            overflow: hidden;
        }

        canvas {
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>쓰레기를 카메라에 보여주세요</h1>
    <div id="webcam-container"></div>
   
    <script src="node_modules/@tensorflow/tfjs/dist/tf.min.js"></script>
    <script src="node_modules/@teachablemachine/image/dist/teachablemachine-image.min.js"></script>
    <script>
        const URL = "https://teachablemachine.withgoogle.com/models/Bu74PJXzl/"; // 모델 URL을 변경하세요

        let model, webcam, maxPredictions;

        // 모델을 로드합니다
        async function init() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            try {
                // 모델과 메타데이터를 로드합니다
                model = await tmImage.load(modelURL, metadataURL);
                maxPredictions = model.getTotalClasses();

                // 웹캠을 설정합니다
                const flip = true; // 웹캠 이미지를 반전시킬지 여부
                webcam = new tmImage.Webcam(640, 480, flip); // width, height, flip
                await webcam.setup({ facingMode: { exact: "environment" } }); // 후면 카메라 설정
                await webcam.play();
                window.requestAnimationFrame(loop);

                // 비디오 캔버스를 webcam-container에 추가합니다
                document.getElementById("webcam-container").appendChild(webcam.canvas);
            } catch (error) {
                console.error("모델 또는 웹캠 로드 중 오류 발생:", error);
            }
        }

        async function loop() {
            webcam.update(); // 웹캠 프레임을 업데이트합니다
            await predict();
            window.requestAnimationFrame(loop);
        }

        // 예측을 수행합니다
        async function predict() {
            const prediction = await model.predict(webcam.canvas);

            // 예측된 클래스와 해당 확률을 확인합니다
            for (let i = 0; i < maxPredictions; i++) {
                const classPrediction = prediction[i].className;
                const probability = prediction[i].probability.toFixed(2);

                if (probability > 0.9) { // 90% 이상의 확률로 인식되면
                    navigateToSite(classPrediction);
                    break;
                }
            }
        }

        // 클래스에 따라 사이트로 이동합니다
        function navigateToSite(className) {
            const sites = {
                "orange": "orange_result.html",
                "egg": "egg_result.html",
                "chicken": "chicken_result.html",
                "vinyl": "vinyl_result.html"
                // 더 많은 클래스를 추가할 수 있습니다
            };

            if (sites[className]) {
                window.location.href = sites[className];
            } else {
                console.error("해당 클래스에 대한 사이트가 없습니다:", className);
            }
        }

        // 초기화
        init();
    </script>
</body>
</html>
 
